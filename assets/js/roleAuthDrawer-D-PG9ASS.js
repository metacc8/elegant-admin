
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{g as z}from"./sys_menu-DeERAZsh.js";import{s as O,b as q}from"./sys_role-DJIK2VWG.js";import{z as F}from"./index-DPTGWM0y.js";import{a as K}from"./element-plus-DdTkCxgE.js";import{d as W,r as u,k as X,aj as n,a as G,W as H,X as s,a1 as l,$ as k,f as C,u as i,_ as L,D as J,n as w}from"./@vue-DJ53MWs5.js";import{_ as Q}from"./vue-esign-BNnrYaMl.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-Dd0W0IWH.js";import"./@imengyu-BQwzwvVc.js";import"./vue-CAygiDOH.js";import"./floating-vue-DjZaMi6K.js";import"./@floating-ui-Y0iFLo_g.js";import"./vue-m-message-BxJX2Zqc.js";import"./overlayscrollbars-CZjZ1Dbc.js";import"./@iconify-C4HLlXtv.js";import"./overlayscrollbars-vue-BxfA_dC8.js";import"./@headlessui-Bm2TyfRI.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-RCkyKLW7.js";import"./lodash-es-l8Yk8yFo.js";import"./pinia-DmVFObHF.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-Bg2mojPD.js";import"./hotkeys-js-BfWqkGRU.js";import"./vue-i18n-BnGu2oZ8.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-PTJBK6lV.js";import"./path-browserify-DTVwunqE.js";import"./axios-DmypytPv.js";import"./@vueuse-Bz9Gvxjd.js";import"./nprogress-BdJdCxhg.js";import"./@element-plus-Ngrzdf6G.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-p2P62yYc.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";const Y={class:"treeMain"},Z={class:"tree-isCheckBox"},ee=W({name:"RoleAuthDrawer",__name:"roleAuthDrawer",setup(te,{expose:D}){const d=u(!1),m=u({title:"角色权限设置"}),o=X({menuList:[],menuTreeList:[],menuChecked:[],isChecked:!1,isIndeterminate:!1,props:{label:e=>e.meta.title,class:B}}),f=u({roleDateType:"ALL",departmentList:[],depChecked:[],props:{label:e=>e.name}}),x=u({checked:[],props:{label:e=>e.name},dashboardOptions:[]});async function T(){const e=await z({});o.menuList=e.data,o.menuTreeList=F(e.data)}async function N(e){const t=await q({id:e});o.menuChecked=t.data||[],await w(()=>{let a=o.menuChecked||[];o.isChecked=a.length>=o.menuList.length,o.isIndeterminate=a.length>0&&a.length<o.menuList.length})}async function V(e){m.value=Object.assign(m.value,e),d.value=!0,await T(),e.rowData.id&&await N(e.rowData.id)}const r=u();function A(e,{checkedKeys:t}){if(t.includes(e.id)){let a=r.value.getNode(e.id);h(e,!0),v(a)}else h(e,!1);b()}function b(){w(()=>{let t=r.value.getCheckedNodes().map(a=>a.id);o.isChecked=t.length===o.menuList.length,o.isIndeterminate=t.length>0&&t.length<o.menuList.length})}function h(e,t){e&&e.children&&e.children.map(a=>{r.value.setChecked(a.id,t),e.children&&h(a,t)})}function v(e){if(e.parent){for(let t in e)t=="id"&&r.value.setChecked(e,!0);e.parent&&e.id!==0&&v(e.parent)}}function I(){o.isChecked?r.value.setCheckedNodes(o.menuList):r.value.setCheckedKeys([]),b()}function R(){o.menuTreeList=[],o.menuChecked=[],o.menuList=[],o.isIndeterminate=!1,o.isChecked=!1,x.value.checked=[]}async function S(){let e=r.value&&r.value.getCheckedNodes(!1,!0).map(a=>a.id),t={roleId:m.value.rowData.id,menuIdList:e,roleData:{roleDateType:f.value.roleDateType}};await O(t),K.success({message:"操作成功!",showClose:!0,duration:1e3}),m.value.getTableList(),d.value=!1}function B(e,t){if(t.isLeaf)return"";let a=!0;for(const _ in t.childNodes)t.childNodes[_].isLeaf||(a=!1);return a?"penultimate-node":""}return D({acceptParams:V}),(e,t)=>{const a=n("el-checkbox"),_=n("el-divider"),E=n("el-tree"),y=n("el-tab-pane"),p=n("el-option"),M=n("el-select"),P=n("el-form-item"),U=n("el-form"),$=n("el-tabs"),g=n("el-button"),j=n("el-drawer");return G(),H(j,{modelValue:i(d),"onUpdate:modelValue":t[3]||(t[3]=c=>J(d)?d.value=c:null),"destroy-on-close":!0,size:"600px",title:`${i(m).title}`,onClosed:R},{footer:s(()=>[l(g,{onClick:t[2]||(t[2]=c=>d.value=!1)},{default:s(()=>[k(" 取消 ")]),_:1}),l(g,{type:"primary",onClick:S},{default:s(()=>[k(" 确定 ")]),_:1})]),default:s(()=>[C("div",null,[l($,{"tab-position":"top"},{default:s(()=>[l(y,{label:"菜单权限"},{default:s(()=>[C("div",Y,[C("div",Z,[l(a,{modelValue:i(o).isChecked,"onUpdate:modelValue":t[0]||(t[0]=c=>i(o).isChecked=c),indeterminate:i(o).isIndeterminate,onChange:I},{default:s(()=>[k(" 全选/反选 ")]),_:1},8,["modelValue","indeterminate"])]),l(_,{"border-style":"dashed"}),l(E,{ref_key:"menuRef",ref:r,"node-key":"id",data:i(o).menuTreeList,props:i(o).props,"check-on-click-node":!0,"check-strictly":!0,"default-checked-keys":i(o).menuChecked,"expand-on-click-node":!1,"highlight-current":"","show-checkbox":"","default-expand-all":"",onCheck:A},null,8,["data","props","default-checked-keys"])])]),_:1}),l(y,{label:"数据权限"},{default:s(()=>[l(U,{"label-width":"100px","label-position":"left"},{default:s(()=>[l(P,{label:"规则类型"},{default:s(()=>[l(M,{modelValue:i(f).roleDateType,"onUpdate:modelValue":t[1]||(t[1]=c=>i(f).roleDateType=c),placeholder:"请选择"},{default:s(()=>[l(p,{label:"全部可见",value:"ALL"}),l(p,{label:"仅部门可见",value:"DEPT"}),l(p,{label:"选择的部门可见",value:"SELECT_DEPT"}),l(p,{label:"仅本人可见",value:"USERSELF"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),L("",!0),L("",!0)]),_:1})])]),_:1},8,["modelValue","title"])}}}),ze=Q(ee,[["__scopeId","data-v-539fd4f0"]]);export{ze as default};
