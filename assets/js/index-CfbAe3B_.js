
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{d as X,i as H,r as w,b as F,w as Q,a as R,c as P,Y as de,a2 as pe,u as a,f as S,a0 as Se,a1 as V,_ as re,m as K,F as q,W as G,X as ee,U as Ce,a7 as ke,p as $e,e as Ne,k as Be,aj as Te,ac as Re,aa as le,D as ve,s as Le,n as fe,o as ge,S as ne,R as Me}from"./@vue-DJ53MWs5.js";import{E as ie,v as Oe,F as De}from"./@vueuse-DVujDNXP.js";import{p as E,o as Z}from"./index-CF0Df7v0.js";import{u as ce,a as Ve,f as he,g as He,_ as ze,d as me,b as Ue,c as je}from"./index-BinNfzbw.js";import{_ as se}from"./icon.vue_vue_type_script_setup_true_lang-CXPPfzEY.js";import{d as Pe}from"./vuedraggable-Ce-5l_FJ.js";import"./nprogress-BdJdCxhg.js";import"./@imengyu-BQwzwvVc.js";import"./vue-CAygiDOH.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-Dd0W0IWH.js";import"./floating-vue-DjZaMi6K.js";import"./@floating-ui-Y0iFLo_g.js";import"./vue-m-message-BxJX2Zqc.js";import"./overlayscrollbars-CZjZ1Dbc.js";import"./@iconify-C4HLlXtv.js";import"./overlayscrollbars-vue-BxfA_dC8.js";import"./@headlessui-Bm2TyfRI.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-RCkyKLW7.js";import"./lodash-es-l8Yk8yFo.js";import"./pinia-DmVFObHF.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-Bg2mojPD.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-C6knWGiR.js";import"./@element-plus-Ngrzdf6G.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-p2P62yYc.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BnGu2oZ8.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-PTJBK6lV.js";import"./path-browserify-DTVwunqE.js";import"./axios-DmypytPv.js";import"./vue-esign-BNnrYaMl.js";import"./sortablejs-C_eVYoc1.js";function We(W,c){let h=null;return function(...u){h&&clearTimeout(h),h=setTimeout(()=>{W.apply(this,u)},c)}}const Ae={class:"elegant-widget-action-item whitespace-nowrap"},Ee={key:0,class:"flex"},Ie=X({__name:"previewWidgets",setup(W,{expose:c}){const h=H("pageManager",{}),u=H("pageSchema"),r=H("design"),C=H("designerProps"),i=w(null),m=w(null),y=w(null),T=w(!1),$=w(!1),t=w(!0),s=w("top"),{canvasScale:l,disabledZoom:p}=ce();let o=null;const O=F(()=>{const e=r.state.checkedNode;return!(!(e!=null&&e.id)||C.value.lockDefaultSchemaEdit&&h.defaultComponentIds.value.includes(e==null?void 0:e.id))}),D=F(()=>{var _,k,B,v,j,I,A;const e=h.componentInstances.value,d=(_=r.state.checkedNode)==null?void 0:_.id;if((B=(k=r.state.checkedNode)==null?void 0:k.componentProps)!=null&&B.hidden)return null;const b=E.getComponentConfingByType((j=(v=r.state)==null?void 0:v.checkedNode)==null?void 0:j.type)??null;if(!d||!(e!=null&&e[d]))return null;if(b!=null&&b.defaultSchema.input&&((I=r.state.checkedNode)==null?void 0:I.noFormItem)!==!0)return(A=e[`${d}formItem`])==null?void 0:A.$el;const n=e[d];return!(n!=null&&n.$el)||(n==null?void 0:n.$el.nodeName)==="#text"||!(n!=null&&n.$el.getBoundingClientRect)?null:n==null?void 0:n.$el}),z=F(()=>{var _,k,B,v;const e=h.componentInstances.value,d=(_=r.state.hoverNode)==null?void 0:_.id,b=E.getComponentConfingByType((k=r.state.hoverNode)==null?void 0:k.type)??null;if(!d||!(e!=null&&e[d]))return null;if(b!=null&&b.defaultSchema.input&&((B=r.state.hoverNode)==null?void 0:B.noFormItem)!==!0)return(v=e[`${d}formItem`])==null?void 0:v.$el;const n=e[d];return(n==null?void 0:n.$el.nodeName)==="#text"?null:n==null?void 0:n.$el}),{mutationObserver:L,observerConfig:N}=ue(J),{startTimedQuery:M,stopTimedQuery:g}=Ve(J);Q(()=>D.value,e=>{if(e){T.value=!0,L.observe(e,N);const d=e.parentNode;d&&(d.ondragstart=()=>{t.value=!1,M()},d.ondragend=()=>{t.value=!0,g()}),J()}else T.value=!1});const{mutationObserver:Y,observerConfig:x}=ue(ae);Q(()=>z.value,e=>{e&&(Y.observe(e,x),ae())});let f=0;Q(()=>{var e;return(e=r.state.hoverNode)==null?void 0:e.id},e=>{if(e){$.value=!0,clearTimeout(f);return}f=setTimeout(()=>{$.value=!1},300)});let U=0,te=0;function J(){const e=D.value;if(!e||!o)return;const{top:d,left:b}=o==null?void 0:o.getBoundingClientRect(),{top:n,left:_,width:k,height:B}=e.getBoundingClientRect(),v=p.value?1:l.value,j=n-d+((o==null?void 0:o.scrollTop)??0)*v,I=_-b+((o==null?void 0:o.scrollLeft)??0)*v,A=B/v;i.value&&(i.value.style.width=`${k/v}px`,i.value.style.height=`${A}px`,i.value.style.top=`${j/v}px`,i.value.style.left=`${I/v}px`,ye(j,I)),y.value&&(j<45&&A<100?(y.value.style.top="",y.value.style.bottom="-30px",y.value.style["border-radius"]="0px 0px 4px 4px",s.value="bottom"):j<45?(y.value.style.top="0px",y.value.style["border-radius"]="0px 0px 4px 0",s.value="center"):(y.value.style.top="-30px",y.value.style["border-radius"]="4px 4px 0px 0px",s.value="top"))}function ye(e,d){const b=D.value;if(!o||!b)return;const n=o.getBoundingClientRect(),{width:_}=b.getBoundingClientRect(),k=p.value?1:l.value,B=e/k-n.top;let v=d/k-n.left+_/k;v<n.width&&(v=0);const j=o.scrollTop-n.height/3+60,I=o.scrollTop+n.height/3*2,A=o.scrollLeft-n.width+200,oe=o.scrollLeft+n.width-200;Math.abs(B-U)<10&&Math.abs(v-te)<10||(U=B,te=v,!(B>j&&B<I&&v>A&&v<oe)&&(o.scrollTop=B,o.scrollLeft=v))}function ae(){var A,oe;const e=z.value;if(!e)return;const{top:d,left:b}=(o==null?void 0:o.getBoundingClientRect())??{top:0,left:0},{top:n,left:_,width:k,height:B}=((A=e.getBoundingClientRect)==null?void 0:A.call(e))??((oe=e.nextElementSibling)==null?void 0:oe.getBoundingClientRect()),v=p.value?1:l.value,j=n-d+((o==null?void 0:o.scrollTop)??0)*v,I=_-b+((o==null?void 0:o.scrollLeft)??0)*v;m.value&&(m.value.style.width=`${k/v}px`,m.value.style.height=`${B/v}px`,m.value.style.top=`${j/v}px`,m.value.style.left=`${I/v}px`)}function ue(e){const d=window.MutationObserver,b={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new d(e),observerConfig:b}}function be(){var k;const e=he(u.schemas,((k=r.state.checkedNode)==null?void 0:k.id)??"root");if(!e)return!1;const{list:d,schema:b,index:n}=e,_=He(b);d.splice(n+1,0,_),r.setCheckedNode(_),Z.push(u.schemas,"复制组件")}function _e(){var _;const e=he(u.schemas,((_=r.state.checkedNode)==null?void 0:_.id)??"root");if(!e)return!1;let{list:d,schema:b,index:n}=e;d.splice(n,1),n===d.length&&n--,r.setCheckedNode(d[n]),Z.push(u.schemas,"删除组件")}function we(e){o=e,o==null||o.addEventListener("scroll",()=>{J()}),ie(D,J),ie(z,ae)}return c({handleInit:we}),(e,d)=>{var b,n,_,k,B;return R(),P(q,null,[de(S("div",{ref_key:"selectorRef",ref:i,class:K(["elegant-checked-widget pointer-events-none absolute z-20",`${s.value} ${t.value?"transition-all":""}`])},[S("div",{ref_key:"actionBoxRef",ref:y,class:"elegant-widget-action-box"},[S("div",Ae,Se((n=a(E).getComponentConfingByType(((b=a(r).state.checkedNode)==null?void 0:b.type)??""))==null?void 0:n.defaultSchema.label),1),O.value?(R(),P("div",Ee,[S("div",{title:"复制",class:"elegant-widget-action-item pointer-events-auto",onClick:be},[V(a(se),{name:"icon-fuzhi3"})]),S("div",{title:"删除",class:"elegant-widget-action-item pointer-events-auto",onClick:_e},[V(a(se),{name:"icon-shanchu1"})])])):re("",!0)],512)],2),[[pe,T.value&&((_=a(r).state.checkedNode)==null?void 0:_.id)!=="root"]]),de(S("div",{ref_key:"hoverWidgetRef",ref:m,class:"elegant-hover-widget pointer-events-none absolute z-998 transition-all"},null,512),[[pe,$.value&&((k=a(r).state.checkedNode)==null?void 0:k.id)!==((B=a(r).state.hoverNode)==null?void 0:B.id)]])],64)}}}),Fe=X({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(W,{emit:c}){const h=W,u=c,r=H("design"),C=H("pageSchema"),i=F({get(){return h.schemas},set(t){u("update:schemas",t)}});function m(t){r.setCheckedNode(i.value[t]),r.setDisableHover(!0)}function y(){r.setDisableHover(),Z.push(C.schemas,"拖拽组件")}function T(){Z.push(C.schemas,"插入组件")}function $(t){var s;return t.type==="page"||(s=E.getComponentConfingByType(t.type).editConstraints)!=null&&s.immovable?"unmover-item":"draggable-item"}return(t,s)=>(R(),G(a(Pe),Ce({modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=l=>i.value=l),"item-key":"id","component-data":{type:"transition-group"},class:"elegant-draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:s[1]||(s[1]=l=>m(l.oldIndex)),onEnd:s[2]||(s[2]=l=>y()),onAdd:s[3]||(s[3]=l=>{m(l.newIndex),T()})}),{item:ee(({element:l,index:p})=>[(R(),P("div",{key:p,class:K(["widget-box",$(l)])},[V(xe,{schema:l},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),xe=X({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(W){const c=W,h=ke(),u=H("design"),r=H("pageManager",{}),C=w(null);$e("nodeAttrs",h);const i=F(()=>{var o,O,D,z,L;const t=r.componentInstances.value,s=(o=c.schema)==null?void 0:o.id,l=E.getComponentConfingByType((O=c.schema)==null?void 0:O.type)??null;if(!s||!(t!=null&&t[s]))return null;if(l!=null&&l.defaultSchema.input&&((D=c.schema)==null?void 0:D.noFormItem)!==!0)return(z=t[`${s}formItem`])==null?void 0:z.$el;const p=t[s];return((L=p==null?void 0:p.$el)==null?void 0:L.nodeName)==="#text"?null:p==null?void 0:p.$el});Q(()=>i.value,t=>{t==null||t.addEventListener("click",m,!1),t==null||t.addEventListener("mouseover",y,!1),t==null||t.addEventListener("mouseout",T,!1)}),Ne(()=>{var t,s,l;(t=i.value)==null||t.removeEventListener("click",m,!1),(s=i.value)==null||s.removeEventListener("mouseover",y,!1),(l=i.value)==null||l.removeEventListener("mouseout",T,!1)});function m(t){t.stopPropagation(),u.setCheckedNode(c.schema)}function y(t){c.schema.type!=="page"&&(t.stopPropagation(),u.setHoverNode(c.schema))}function T(t){t.stopPropagation(),u.setHoverNode(null)}const $=Be({...c.schema});return Q(()=>c.schema,t=>{Object.assign($,t)},{deep:!0}),(t,s)=>{var p,o;const l=Te("ENodeItem");return R(),G(a(ze),{ref_key:"nodeRef",ref:C,"component-schema":c.schema},Re({_:2},[(o=(p=a(E).getComponentConfingByType(c.schema.type))==null?void 0:p.editConstraints)!=null&&o.childImmovable?{name:"edit-node",fn:ee(()=>[(R(!0),P(q,null,le(a($).children,O=>(R(),G(l,{key:O.id,schema:O},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:ee(()=>[a($).children?(R(),G(Fe,{key:0,schemas:a($).children,"onUpdate:schemas":s[0]||(s[0]=O=>a($).children=O)},null,8,["schemas"])):re("",!0)]),key:"1"}]),1032,["component-schema"])}}}),Je={class:"h-full min-w-750px rounded"},Ze=X({__name:"previewJson",setup(W,{expose:c}){const h=E.getComponent("modal"),u=E.getComponent("monacoEditor"),r={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},C=w(null),i=w(!1),m=H("pageSchema");function y(){i.value=!1}function T(){i.value=!0,C.value?C.value.setValue(JSON.stringify(m,null,2)):setTimeout(()=>{T()},300)}function $(t="elegant-data.json"){let s="data:text/json;charset=utf-8,";s+=JSON.stringify(m,null,2);let l=encodeURI(s),p=document.createElement("a");p.setAttribute("href",l),p.setAttribute("download",t),p.click()}return c({handleOpen:T}),(t,s)=>(R(),G(a(h),{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=l=>i.value=l),title:"查看数据",class:"w-900px",width:"900px","ok-text":"导出数据",onClose:y,onOk:$},{default:ee(()=>[S("div",Je,[V(a(u),{ref_key:"monacoEditorRef",ref:C,class:"editor h-full","auto-toggle-theme":"",config:r,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Qe={class:"elegant-edit-toolbar flex items-center justify-between px-4"},Xe={class:"h-full flex flex-1 items-center"},Ye=["title","onClick"],Ke={class:"h-full flex flex-1 items-center justify-center"},qe=["title","onClick"],Ge={class:"h-full flex flex-1 items-center justify-end"},et={key:0,class:"ml-12px flex items-center"},tt={class:"w-82px cursor-pointer pr-8px"},ot={class:"w-90px cursor-pointer"},nt=X({__name:"toolbar",setup(W){const c=E.getComponent("slider"),h=E.getComponent("select"),{canvasScale:u,disabledZoom:r}=ce(),C=w("pc"),i=H("pageSchema"),m=H("design"),y=w(null),T=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"平板",key:"pad"},{icon:"icon-a-shoujitoubu",title:"手机",key:"mobile"}],$=Z.recordList,t=Z.undoList,s=F(()=>[{icon:"icon-daima1",title:"查看数据",on:()=>z()},{icon:"icon-shanchu1",title:"清空",on:D},{icon:"icon-chexiao2x",title:"撤销",on:o,disabled:!$.value.length},{icon:"icon-fanhui2x",title:"重做",on:O,disabled:!t.value.length}]),l=F({get(){return`${(u.value*100).toFixed(0)}%`},set(N){u.value=Number(N)}}),p=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function o(){const N=Z.undo();N&&(me(i.schemas,N),m.setCheckedNode(i.schemas[0]))}function O(){const N=Z.redo();N&&(me(i.schemas,N),m.setCheckedNode(i.schemas[0]))}function D(){m.reset()}function z(){y.value.handleOpen()}function L(N){m.handleToggleDeviceMode(N),C.value=N;const M={pc:{},pad:{width:"800px",mode:N},mobile:{width:"420px",mode:N}};i.canvas=M[N]}return(N,M)=>(R(),P(q,null,[S("div",Qe,[S("div",Xe,[(R(!0),P(q,null,le(s.value,(g,Y)=>(R(),P("div",{key:Y,title:g.title,class:K(["elegant-action-item h-90% flex cursor-pointer items-center px-10px",{disabled:g.disabled}]),onClick:g.on},[V(a(se),{name:g.icon},null,8,["name"])],10,Ye))),128))]),S("div",Ke,[(R(),P(q,null,le(T,g=>S("div",{key:g.key,title:g.title,class:K(["elegant-device-item h-90% flex cursor-pointer items-center px-10px",{checked:g.key===C.value}]),onClick:Y=>L(g.key)},[V(a(se),{name:g.icon},null,8,["name"])],10,qe)),64))]),S("div",Ge,[a(r)?re("",!0):(R(),P("div",et,[S("div",tt,[V(a(h),{value:l.value,"onUpdate:value":M[0]||(M[0]=g=>l.value=g),modelValue:l.value,"onUpdate:modelValue":M[1]||(M[1]=g=>l.value=g),options:p,size:"small"},null,8,["value","modelValue"])]),S("div",ot,[V(a(c),{value:a(u),"onUpdate:value":M[2]||(M[2]=g=>ve(u)?u.value=g:null),modelValue:a(u),"onUpdate:modelValue":M[3]||(M[3]=g=>ve(u)?u.value=g:null),min:.6,max:1.4,step:.01,tooltip:!1},null,8,["value","modelValue"])])]))])]),V(Ze,{ref_key:"previewJson",ref:y},null,512)],64))}}),st={class:"relative h-full flex flex-col"},at=["draggable"],lt=X({__name:"editScreenContainer",setup(W){const c=H("pageSchema"),h=w(null),u=w(null),r=w(null),{pressSpace:C,disabledZoom:i}=ce(),{handleElementDragStart:m,handleElementDrag:y,handleElementDragEnd:T}=Ue(h),{width:$,height:t}=Oe(h),{canvasScale:s,handleZoom:l}=je(u);let p=0,o=0;const O=w({}),D=w({}),z=w({}),L=Le({width:0,height:0});Q(()=>{var x,f;return{width:(x=c.canvas)==null?void 0:x.width,height:(f=c.canvas)==null?void 0:f.height}},M),Q(z,()=>{fe(N)}),ge(()=>{var x,f;M({width:(x=c.canvas)==null?void 0:x.width,height:(f=c.canvas)==null?void 0:f.height})});function N(){const x=a(r);x&&(L.value={width:x.clientWidth,height:x.clientHeight})}function M({width:x,height:f}){z.value={width:x??"0",height:f??"0"}}De($,g),Q(L,g);function g(){if(i.value){D.value={width:`${p}px`,height:`${o}px`,transform:"translate(0px, 20px)"};return}let x=L.value.width||p,f=L.value.height||o;O.value={width:`${$.value+x}px`,height:`${t.value+f}px`},D.value={width:`${x}px`,height:`${f}px`},Y()}function Y(){fe(()=>{var J;let x=L.value.width||p;const U=(L.value.height||o)/2,te=x/2;(J=h.value)==null||J.scrollTo(te,U)})}return ie(h,([{contentRect:x}])=>{if(p=x.width-40,o=x.height-40,!i.value)if(L.value.width===0)s.value=1;else{const f=(p-20)/L.value.width;s.value=f<1.2?f:s.value}We(g,50)()}),(x,f)=>(R(),P("div",st,[V(nt),S("div",{ref_key:"editScreenContainerRef",ref:h,class:K(["elegant-edit-screen-container flex-1 overflow-auto overflow-y-hidden",{"cursor-grab":a(C)}]),draggable:a(C),onWheel:f[0]||(f[0]=(...U)=>a(l)&&a(l)(...U)),onDragstart:f[1]||(f[1]=(...U)=>a(m)&&a(m)(...U)),onDragend:f[2]||(f[2]=(...U)=>a(T)&&a(T)(...U)),onDrag:f[3]||(f[3]=(...U)=>a(y)&&a(y)(...U))},[S("div",{id:"canvasContainer",class:"flex items-center justify-center",style:ne(O.value)},[S("div",{ref_key:"draggableElRef",ref:u,class:"transition-all"},[S("div",{class:K({"pointer-events-none":a(C)}),style:ne(D.value)},[Me(x.$slots,"default")],6)],512)],4)],42,at),S("div",{ref_key:"sizeBoxRef",ref:r,class:"pointer-events-none absolute op-0",style:ne(z.value)},null,4)]))}}),it={class:"elegant-edit-canvas"},Xt=X({__name:"index",setup(W){const c=w(null),h=w(null),u=H("pageSchema"),r=F(()=>u.schemas[0]),C=F(()=>({width:"100%",height:"100%"}));return ge(()=>{var i;(i=h.value)==null||i.handleInit(c.value)}),(i,m)=>(R(),P("section",it,[V(lt,null,{default:ee(()=>[S("div",{ref_key:"elegantEditRangeRef",ref:c,class:"elegant-edit-range relative overflow-auto rounded-md",style:ne(C.value)},[V(xe,{schema:r.value},null,8,["schema"]),V(Ie,{ref_key:"ePreviewWidgetsRef",ref:h},null,512)],4)]),_:1})]))}});export{Xt as default};
