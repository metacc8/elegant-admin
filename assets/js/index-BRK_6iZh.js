
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{d as X,i as H,r as _,b as I,w as Z,a as T,c as W,Y as de,a2 as ve,u as r,f as S,a0 as Se,a1 as V,_ as re,m as K,F as q,W as G,X as ee,U as Ce,a7 as ke,p as $e,e as Ne,aj as Re,ac as Be,aa as ae,D as he,s as Te,n as fe,o as ge,S as ne,R as Le}from"./@vue-DJ53MWs5.js";import{E as ie,v as Oe,F as Me}from"./@vueuse-Bz9Gvxjd.js";import{p as A,o as J}from"./index-Cq3st1AW.js";import{u as ce,a as De,f as me,g as Ve,_ as He,d as pe,b as ze,c as Ue}from"./index-Qoy7mnTm.js";import{_ as se}from"./icon.vue_vue_type_script_setup_true_lang-CXPPfzEY.js";import{d as Pe}from"./vuedraggable-Ce-5l_FJ.js";import"./nprogress-BdJdCxhg.js";import"./@imengyu-BQwzwvVc.js";import"./vue-CAygiDOH.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-Dd0W0IWH.js";import"./floating-vue-DjZaMi6K.js";import"./@floating-ui-Y0iFLo_g.js";import"./vue-m-message-BxJX2Zqc.js";import"./overlayscrollbars-CZjZ1Dbc.js";import"./@iconify-C4HLlXtv.js";import"./overlayscrollbars-vue-BxfA_dC8.js";import"./@headlessui-Bm2TyfRI.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-RCkyKLW7.js";import"./lodash-es-l8Yk8yFo.js";import"./pinia-DmVFObHF.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-Bg2mojPD.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-DdTkCxgE.js";import"./@element-plus-Ngrzdf6G.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-p2P62yYc.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BnGu2oZ8.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-PTJBK6lV.js";import"./path-browserify-DTVwunqE.js";import"./axios-DmypytPv.js";import"./vue-esign-BNnrYaMl.js";import"./sortablejs-C_eVYoc1.js";function We(j,c){let m=null;return(...u)=>{m&&clearTimeout(m),m=setTimeout(()=>{j(...u)},c)}}const je={class:"elegant-widget-action-item whitespace-nowrap"},Ae={key:0,class:"flex"},Ee=X({__name:"previewWidgets",setup(j,{expose:c}){const m=H("pageManager",{}),u=H("pageSchema"),i=H("designer"),C=H("designerProps"),a=_(null),p=_(null),y=_(null),R=_(!1),B=_(!1),t=_(!0),s=_("top"),{canvasScale:l,disabledZoom:v}=ce();let o=null;const M=I(()=>{const e=i.state.checkedNode;return!(!(e!=null&&e.id)||C.value.lockDefaultSchemaEdit&&m.defaultComponentIds.value.includes(e==null?void 0:e.id))}),D=I(()=>{var w,k,N,h,P,E;const e=m.componentInstances.value,d=(w=i.state.checkedNode)==null?void 0:w.id;if((N=(k=i.state.checkedNode)==null?void 0:k.componentProps)!=null&&N.hidden)return null;const b=A.getComponentConfingByType((h=i.state.checkedNode)==null?void 0:h.type)??null;if(!d||!(e!=null&&e[d]))return null;if(b!=null&&b.defaultSchema.input&&((P=i.state.checkedNode)==null?void 0:P.noFormItem)!==!0)return(E=e[`${d}formItem`])==null?void 0:E.$el;const n=e[d];return!(n!=null&&n.$el)||(n==null?void 0:n.$el.nodeName)==="#text"||!(n!=null&&n.$el.getBoundingClientRect)?null:n==null?void 0:n.$el}),z=I(()=>{var w,k,N,h;const e=m.componentInstances.value,d=(w=i.state.hoverNode)==null?void 0:w.id,b=A.getComponentConfingByType((k=i.state.hoverNode)==null?void 0:k.type)??null;if(!d||!(e!=null&&e[d]))return null;if(b!=null&&b.defaultSchema.input&&((N=i.state.hoverNode)==null?void 0:N.noFormItem)!==!0)return(h=e[`${d}formItem`])==null?void 0:h.$el;const n=e[d];return(n==null?void 0:n.$el.nodeName)==="#text"?null:n==null?void 0:n.$el}),{mutationObserver:L,observerConfig:$}=ue(F),{startTimedQuery:O,stopTimedQuery:g}=De(F);Z(()=>D.value,e=>{if(e){R.value=!0,L.observe(e,$);const d=e.parentNode;d&&(d.ondragstart=()=>{t.value=!1,O()},d.ondragend=()=>{t.value=!0,g()}),F()}else R.value=!1});const{mutationObserver:Y,observerConfig:x}=ue(le);Z(()=>z.value,e=>{e&&(Y.observe(e,x),le())});let f=0;Z(()=>{var e;return(e=i.state.hoverNode)==null?void 0:e.id},e=>{if(e){B.value=!0,clearTimeout(f);return}f=setTimeout(()=>{B.value=!1},300)});let U=0,te=0;function F(){const e=D.value;if(!e||!o)return;const{top:d,left:b}=o==null?void 0:o.getBoundingClientRect(),{top:n,left:w,width:k,height:N}=e.getBoundingClientRect(),h=v.value?1:l.value,P=n-d+((o==null?void 0:o.scrollTop)??0)*h,E=w-b+((o==null?void 0:o.scrollLeft)??0)*h,Q=N/h;a.value&&(a.value.style.width=`${k/h}px`,a.value.style.height=`${Q}px`,a.value.style.top=`${P/h}px`,a.value.style.left=`${E/h}px`,ye(P,E)),y.value&&(P<45&&Q<100?(y.value.style.top="",y.value.style.bottom="-30px",y.value.style.borderRadius="0px 0px 4px 4px",s.value="bottom"):P<45?(y.value.style.top="0px",y.value.style.borderRadius="0px 0px 4px 0",s.value="center"):(y.value.style.top="-30px",y.value.style.borderRadius="4px 4px 0px 0px",s.value="top"))}function ye(e,d){const b=D.value;if(!o||!b)return;const n=o.getBoundingClientRect(),{width:w}=b.getBoundingClientRect(),k=v.value?1:l.value,N=e/k-n.top;let h=d/k-n.left+w/k;h<n.width&&(h=0);const P=o.scrollTop-n.height/3+60,E=o.scrollTop+n.height/3*2,Q=o.scrollLeft-n.width+200,oe=o.scrollLeft+n.width-200;Math.abs(N-U)<10&&Math.abs(h-te)<10||(U=N,te=h,!(N>P&&N<E&&h>Q&&h<oe)&&(o.scrollTop=N,o.scrollLeft=h))}function le(){var Q,oe;const e=z.value;if(!e)return;const{top:d,left:b}=(o==null?void 0:o.getBoundingClientRect())??{top:0,left:0},{top:n,left:w,width:k,height:N}=((Q=e.getBoundingClientRect)==null?void 0:Q.call(e))??((oe=e.nextElementSibling)==null?void 0:oe.getBoundingClientRect()),h=v.value?1:l.value,P=n-d+((o==null?void 0:o.scrollTop)??0)*h,E=w-b+((o==null?void 0:o.scrollLeft)??0)*h;p.value&&(p.value.style.width=`${k/h}px`,p.value.style.height=`${N/h}px`,p.value.style.top=`${P/h}px`,p.value.style.left=`${E/h}px`)}function ue(e){const d=window.MutationObserver,b={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new d(e),observerConfig:b}}function be(){var k;const e=me(u.schemas,((k=i.state.checkedNode)==null?void 0:k.id)??"root");if(!e)return!1;const{list:d,schema:b,index:n}=e,w=Ve(b);d.splice(n+1,0,w),i.setCheckedNode(w),J.push(u.schemas,"复制组件")}function _e(){var w;const e=me(u.schemas,((w=i.state.checkedNode)==null?void 0:w.id)??"root");if(!e)return!1;let{list:d,schema:b,index:n}=e;d.splice(n,1),n===d.length&&n--,i.setCheckedNode(d[n]),J.push(u.schemas,"删除组件")}function we(e){o=e,o==null||o.addEventListener("scroll",()=>{F()}),ie(D,F),ie(z,le)}return c({handleInit:we}),(e,d)=>{var b,n,w,k,N;return T(),W(q,null,[de(S("div",{ref_key:"selectorRef",ref:a,class:K(["elegant-checked-widget pointer-events-none absolute z-20",`${s.value} ${t.value?"transition-all":""}`])},[S("div",{ref_key:"actionBoxRef",ref:y,class:"elegant-widget-action-box"},[S("div",je,Se((n=r(A).getComponentConfingByType(((b=r(i).state.checkedNode)==null?void 0:b.type)??""))==null?void 0:n.defaultSchema.label),1),M.value?(T(),W("div",Ae,[S("div",{title:"复制",class:"elegant-widget-action-item pointer-events-auto",onClick:be},[V(r(se),{name:"icon-fuzhi3"})]),S("div",{title:"删除",class:"elegant-widget-action-item pointer-events-auto",onClick:_e},[V(r(se),{name:"icon-shanchu1"})])])):re("",!0)],512)],2),[[ve,R.value&&((w=r(i).state.checkedNode)==null?void 0:w.id)!=="root"]]),de(S("div",{ref_key:"hoverWidgetRef",ref:p,class:"elegant-hover-widget pointer-events-none absolute z-998 transition-all"},null,512),[[ve,B.value&&((k=r(i).state.checkedNode)==null?void 0:k.id)!==((N=r(i).state.hoverNode)==null?void 0:N.id)]])],64)}}}),Ie=X({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(j,{emit:c}){const m=j,u=c,i=H("designer"),C=H("pageSchema"),a=I({get(){return m.schemas},set(t){u("update:schemas",t)}});function p(t){i.setCheckedNode(a.value[t]),i.setDisableHover(!0)}function y(){i.setDisableHover(),J.push(C.schemas,"拖拽组件")}function R(){J.push(C.schemas,"插入组件")}function B(t){var s;return t.type==="page"||(s=A.getComponentConfingByType(t.type).editConstraints)!=null&&s.immovable?"unmover-item":"draggable-item"}return(t,s)=>(T(),G(r(Pe),Ce({modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=l=>a.value=l),"item-key":"id","component-data":{type:"transition-group"},class:"elegant-draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:s[1]||(s[1]=l=>p(l.oldIndex)),onEnd:s[2]||(s[2]=l=>y()),onAdd:s[3]||(s[3]=l=>{p(l.newIndex),R()})}),{item:ee(({element:l,index:v})=>[(T(),W("div",{key:v,class:K(["widget-box",B(l)])},[V(xe,{schema:l},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),xe=X({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(j){const c=j,m=ke(),u=H("designer"),i=H("pageManager",{}),C=_(null);$e("nodeAttrs",m);const a=I(()=>{var o,M,D,z,L;const t=i.componentInstances.value,s=(o=c.schema)==null?void 0:o.id,l=A.getComponentConfingByType((M=c.schema)==null?void 0:M.type)??null;if(!s||!(t!=null&&t[s]))return null;if(l!=null&&l.defaultSchema.input&&((D=c.schema)==null?void 0:D.noFormItem)!==!0)return(z=t[`${s}formItem`])==null?void 0:z.$el;const v=t[s];return((L=v==null?void 0:v.$el)==null?void 0:L.nodeName)==="#text"?null:v==null?void 0:v.$el});Z(()=>a.value,t=>{t==null||t.addEventListener("click",p,!1),t==null||t.addEventListener("mouseover",y,!1),t==null||t.addEventListener("mouseout",R,!1)}),Ne(()=>{var t,s,l;(t=a.value)==null||t.removeEventListener("click",p,!1),(s=a.value)==null||s.removeEventListener("mouseover",y,!1),(l=a.value)==null||l.removeEventListener("mouseout",R,!1)});function p(t){t.stopPropagation(),u.setCheckedNode(c.schema)}function y(t){c.schema.type!=="page"&&(t.stopPropagation(),u.setHoverNode(c.schema))}function R(t){t.stopPropagation(),u.setHoverNode(null)}const B=_(c.schema);return Z(()=>c.schema,t=>{B.value=t},{deep:!0}),(t,s)=>{var v,o;const l=Re("ENodeItem");return T(),G(r(He),{ref_key:"nodeRef",ref:C,"component-schema":c.schema},Be({_:2},[(o=(v=r(A).getComponentConfingByType(c.schema.type))==null?void 0:v.editConstraints)!=null&&o.childImmovable?{name:"edit-node",fn:ee(()=>[(T(!0),W(q,null,ae(c.schema.children,M=>(T(),G(l,{key:M.id,schema:M},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:ee(()=>[c.schema.children?(T(),G(Ie,{key:0,schemas:B.value.children,"onUpdate:schemas":s[0]||(s[0]=M=>B.value.children=M)},null,8,["schemas"])):re("",!0)]),key:"1"}]),1032,["component-schema"])}}}),Fe={class:"h-full min-w-750px rounded"},Je=X({__name:"previewJson",setup(j,{expose:c}){const m=A.getComponent("modal"),u=A.getComponent("monacoEditor"),i={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},C=_(null),a=_(!1),p=H("pageSchema");function y(){a.value=!1}function R(){a.value=!0,C.value?C.value.setValue(JSON.stringify(p,null,2)):setTimeout(()=>{R()},300)}function B(t="elegant-data.json"){let s="data:text/json;charset=utf-8,";s+=JSON.stringify(p,null,2);let l=encodeURI(s),v=document.createElement("a");v.setAttribute("href",l),v.setAttribute("download",t),v.click()}return c({handleOpen:R}),(t,s)=>(T(),G(r(m),{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=l=>a.value=l),title:"查看数据",class:"w-900px",width:"900px","ok-text":"导出数据",onClose:y,onOk:B},{default:ee(()=>[S("div",Fe,[V(r(u),{ref_key:"monacoEditorRef",ref:C,class:"editor h-full","auto-toggle-theme":"",config:i,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Ze={class:"elegant-edit-toolbar flex items-center justify-between px-4"},Qe={class:"h-full flex flex-1 items-center"},Xe=["title","onClick"],Ye={class:"h-full flex flex-1 items-center justify-center"},Ke=["title","onClick"],qe={class:"h-full flex flex-1 items-center justify-end"},Ge={key:0,class:"ml-12px flex items-center"},et={class:"w-82px cursor-pointer pr-8px"},tt={class:"w-90px cursor-pointer"},ot=X({__name:"toolbar",setup(j){const c=A.getComponent("slider"),m=A.getComponent("select"),{canvasScale:u,disabledZoom:i}=ce(),C=_("pc"),a=H("pageSchema"),p=H("designer"),y=_(null),R=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"平板",key:"pad"},{icon:"icon-a-shoujitoubu",title:"手机",key:"mobile"}],B=J.recordList,t=J.undoList,s=I(()=>[{icon:"icon-daima1",title:"查看数据",on:()=>z()},{icon:"icon-shanchu1",title:"清空",on:D},{icon:"icon-chexiao2x",title:"撤销",on:o,disabled:!B.value.length},{icon:"icon-fanhui2x",title:"重做",on:M,disabled:!t.value.length}]),l=I({get(){return`${(u.value*100).toFixed(0)}%`},set($){u.value=Number($)}}),v=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function o(){const $=J.undo();$&&(pe(a.schemas,$),p.setCheckedNode(a.schemas[0]))}function M(){const $=J.redo();$&&(pe(a.schemas,$),p.setCheckedNode(a.schemas[0]))}function D(){p.reset()}function z(){y.value.handleOpen()}function L($){p.handleToggleDeviceMode($),C.value=$;const O={pc:{},pad:{width:"800px",mode:$},mobile:{width:"420px",mode:$}};a.canvas=O[$]}return($,O)=>(T(),W(q,null,[S("div",Ze,[S("div",Qe,[(T(!0),W(q,null,ae(s.value,(g,Y)=>(T(),W("div",{key:Y,title:g.title,class:K(["elegant-action-item h-80% flex cursor-pointer items-center px-10px",{disabled:g.disabled}]),onClick:g.on},[V(r(se),{name:g.icon},null,8,["name"])],10,Xe))),128))]),S("div",Ye,[(T(),W(q,null,ae(R,g=>S("div",{key:g.key,title:g.title,class:K(["elegant-device-item h-80% flex cursor-pointer items-center px-10px",{checked:g.key===C.value}]),onClick:Y=>L(g.key)},[V(r(se),{name:g.icon},null,8,["name"])],10,Ke)),64))]),S("div",qe,[r(i)?re("",!0):(T(),W("div",Ge,[S("div",et,[V(r(m),{value:l.value,"onUpdate:value":O[0]||(O[0]=g=>l.value=g),modelValue:l.value,"onUpdate:modelValue":O[1]||(O[1]=g=>l.value=g),options:v,size:"small"},null,8,["value","modelValue"])]),S("div",tt,[V(r(c),{value:r(u),"onUpdate:value":O[2]||(O[2]=g=>he(u)?u.value=g:null),modelValue:r(u),"onUpdate:modelValue":O[3]||(O[3]=g=>he(u)?u.value=g:null),min:.6,max:1.4,step:.01,tooltip:!1},null,8,["value","modelValue"])])]))])]),V(Je,{ref_key:"previewJson",ref:y},null,512)],64))}}),nt={class:"relative h-full flex flex-col"},st=["draggable"],lt=X({__name:"editScreenContainer",setup(j){const c=H("pageSchema"),m=_(null),u=_(null),i=_(null),{pressSpace:C,disabledZoom:a}=ce(),{handleElementDragStart:p,handleElementDrag:y,handleElementDragEnd:R}=ze(m),{width:B,height:t}=Oe(m),{canvasScale:s,handleZoom:l}=Ue(u);let v=0,o=0;const M=_({}),D=_({}),z=_({}),L=Te({width:0,height:0});Z(()=>{var x,f;return{width:(x=c.canvas)==null?void 0:x.width,height:(f=c.canvas)==null?void 0:f.height}},O),Z(z,()=>{fe($)}),ge(()=>{var x,f;O({width:(x=c.canvas)==null?void 0:x.width,height:(f=c.canvas)==null?void 0:f.height})});function $(){const x=r(i);x&&(L.value={width:x.clientWidth,height:x.clientHeight})}function O({width:x,height:f}){z.value={width:x??"0",height:f??"0"}}Me(B,g),Z(L,g);function g(){if(a.value){D.value={width:`${v}px`,height:`${o}px`,transform:"translate(0px, 20px)"};return}let x=L.value.width||v,f=L.value.height||o;M.value={width:`${B.value+x}px`,height:`${t.value+f}px`},D.value={width:`${x}px`,height:`${f}px`},Y()}function Y(){fe(()=>{var F;let x=L.value.width||v;const U=(L.value.height||o)/2,te=x/2;(F=m.value)==null||F.scrollTo(te,U)})}return ie(m,([{contentRect:x}])=>{if(v=x.width-40,o=x.height-40,!a.value)if(L.value.width===0)s.value=1;else{const f=(v-20)/L.value.width;s.value=f<1.2?f:s.value}We(g,50)()}),(x,f)=>(T(),W("div",nt,[V(ot),S("div",{ref_key:"editScreenContainerRef",ref:m,class:K(["elegant-edit-screen-container flex-1 overflow-auto overflow-y-hidden",{"cursor-grab":r(C)}]),draggable:r(C),onWheel:f[0]||(f[0]=(...U)=>r(l)&&r(l)(...U)),onDragstart:f[1]||(f[1]=(...U)=>r(p)&&r(p)(...U)),onDragend:f[2]||(f[2]=(...U)=>r(R)&&r(R)(...U)),onDrag:f[3]||(f[3]=(...U)=>r(y)&&r(y)(...U))},[S("div",{id:"canvasContainer",class:"flex items-center justify-center",style:ne(M.value)},[S("div",{ref_key:"draggableElRef",ref:u,class:"transition-all"},[S("div",{class:K({"pointer-events-none":r(C)}),style:ne(D.value)},[Le(x.$slots,"default")],6)],512)],4)],42,st),S("div",{ref_key:"sizeBoxRef",ref:i,class:"pointer-events-none absolute op-0",style:ne(z.value)},null,4)]))}}),at={class:"elegant-edit-canvas"},Qt=X({__name:"index",setup(j){const c=_(null),m=_(null),u=H("pageSchema"),i=I(()=>u.schemas[0]),C=I(()=>({width:"100%",height:"100%"}));return ge(()=>{var a;(a=m.value)==null||a.handleInit(c.value)}),(a,p)=>(T(),W("section",at,[V(lt,null,{default:ee(()=>[S("div",{ref_key:"elegantEditRangeRef",ref:c,class:"elegant-edit-range relative overflow-auto rounded-md",style:ne(C.value)},[V(xe,{schema:i.value},null,8,["schema"]),V(Ee,{ref_key:"ePreviewWidgetsRef",ref:m},null,512)],4)]),_:1})]))}});export{Qt as default};
