
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{p as O}from"./index-DPTGWM0y.js";import{d as Y}from"./vuedraggable-Ce-5l_FJ.js";import{h as F,_ as q,e as G,i as H}from"./index-Bk_RL8th.js";import{_ as D}from"./icon.vue_vue_type_script_setup_true_lang-CXPPfzEY.js";import{d as M,i as R,r as E,w as J,a as p,c as g,aa as z,f as c,a0 as A,a1 as b,u as h,X as B,_ as Q,$ as T,F as U,b as S,Y as P,a2 as W,m as K,k as Z,W as L,n as ee,ag as X}from"./@vue-DJ53MWs5.js";import{_ as te}from"./tree.vue_vue_type_script_setup_true_lang-CHuy7oBg.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-Dd0W0IWH.js";import"./@imengyu-BQwzwvVc.js";import"./vue-CAygiDOH.js";import"./floating-vue-DjZaMi6K.js";import"./@floating-ui-Y0iFLo_g.js";import"./vue-m-message-BxJX2Zqc.js";import"./overlayscrollbars-CZjZ1Dbc.js";import"./@iconify-C4HLlXtv.js";import"./overlayscrollbars-vue-BxfA_dC8.js";import"./@headlessui-Bm2TyfRI.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-RCkyKLW7.js";import"./lodash-es-l8Yk8yFo.js";import"./pinia-DmVFObHF.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-Bg2mojPD.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-DdTkCxgE.js";import"./@vueuse-Bz9Gvxjd.js";import"./nprogress-BdJdCxhg.js";import"./@element-plus-Ngrzdf6G.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-p2P62yYc.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BnGu2oZ8.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-PTJBK6lV.js";import"./path-browserify-DTVwunqE.js";import"./axios-DmypytPv.js";import"./sortablejs-C_eVYoc1.js";import"./vue-esign-BNnrYaMl.js";const ne={class:"elegant-event-info"},oe=["title"],ae={class:"elegant-event-btn"},le={class:"elegant-action-editor-main"},se={class:"elegant-editor-item"},ie={class:"w-36px text-lg"},ce={class:"flex-1"},de={key:0},ue={key:1},re={key:2},me={class:"elegant-action-box"},pe=["onClick"],ve=["onClick"],fe=M({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>{}},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup($,{emit:k}){const r=$,x=k,C=R("pageSchema"),y=E(r.events);J(()=>r.events,e=>{y.value=e},{deep:!0,immediate:!0});function _(e){x("add",e)}function m(e){return F(C.schemas,e).label}function u(e,l){var f;const n=v(l);n[l]=r.events[l].filter((N,w)=>e!==w),(f=n[l])!=null&&f.length||delete n[l],x("update:modelValue",n)}function a(e,l,n){x("edit",e,l,n)}function v(e){const l={};return r.allEvents.forEach(n=>{if(!r.events[n.type].length||n.type===e)return!1;l[n.type]=r.events[n.type]}),l}return(e,l)=>(p(!0),g(U,null,z($.itemEvents,n=>(p(),g("div",{key:n.type,class:"elegant-event-item"},[c("div",ne,[c("div",{class:"elegant-event-label",title:n.describe},A(n.describe),9,oe),c("div",ae,[b(h(D),{name:"icon-tianjia1",onClick:f=>_(n.type)},null,8,["onClick"])])]),c("div",le,[b(h(Y),{modelValue:h(y)[n.type],"onUpdate:modelValue":f=>h(y)[n.type]=f,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:B(({element:f,index:N})=>[c("div",se,[c("div",ie,[b(h(D),{class:"handle mr-2 cursor-move text-lg",name:"icon-tuozhuai"})]),c("div",ce,[f.type==="component"?(p(),g("div",de,A(m(f.componentId)),1)):f.type==="custom"?(p(),g("div",ue," 自定义函数 ")):f.type==="public"?(p(),g("div",re," 公共函数 ")):Q("",!0),T(" "+A(f.methodName),1)]),c("div",me,[c("div",{class:"elegant-edit-btn",onClick:w=>a(N,n.type,f)},[b(h(D),{name:"icon-tiaozheng"})],8,pe),c("div",{class:"elegant-del-btn",onClick:w=>u(N,n.type)},[b(h(D),{name:"icon-shanchu1"})],8,ve)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),he={class:"h-full flex flex-col"},ge=c("div",{class:"pb-2"}," 自定义函数编辑 ",-1),_e=M({__name:"EScriptEdit",setup($){const k=O.getComponent("monacoEditor"),r={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},x=E(null),C=R("pageSchema");return(y,_)=>(p(),g("div",he,[ge,b(h(k),{ref_key:"monacoEditorRef",ref:x,modelValue:h(C).script,"onUpdate:modelValue":_[0]||(_[0]=m=>h(C).script=m),"auto-toggle-theme":"",class:"elegant-editor flex-1",config:r,language:"javascript"},null,8,["modelValue"])]))}}),ye={class:"elegant-attribute-view"},Ie=["title"],xe={class:"elegant-attr-input"},Ce=M({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup($,{emit:k}){const r=$,x=k,C=S(()=>r.modelValue?JSON.parse(r.modelValue):[]);function y(m){var u;return typeof m.show=="boolean"?m.show:typeof m.show=="function"?(u=m.show)==null?void 0:u.call(m,{values:C.value}):!0}function _(m,u){const a=[...JSON.parse(r.modelValue??"[]")];a[u]=m,x("update:modelValue",JSON.stringify(a))}return(m,u)=>(p(),g("div",ye,[(p(!0),g(U,null,z(r.actionArgsConfigs,a=>(p(),g("div",{key:a.field+a.type},[P(c("div",{class:K(["elegant-attr-item",a.layout])},[c("div",{class:"elegant-attr-label",title:a.label},A(a.label),9,Ie),c("div",xe,[b(h(q),{"component-schema":{...a,componentProps:{...a.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":C.value[a.field],"onUpdate:modelValue":v=>_(v,a.field)},null,8,["component-schema","model-value","onUpdate:modelValue"])])],2),[[W,y(a)]])]))),128))]))}}),Ve={class:"elegant-modal-action-main rounded"},be={class:"elegant-modal-left-panel h-full flex flex-col"},ke={class:"h-0 flex flex-1 flex-col"},Ee={class:"h-0 flex-1"},$e={class:"elegant-action-select h-30/100 flex flex-col"},Ne=c("div",{class:"mb-2"}," 动作选择 ",-1),we={class:"flex-1 overflow-auto pr-8px"},Oe=["onClick"],Se={class:"pt-42px text-center text-gray-400"},Ae={class:"elegant-modal-right-panel"},Ue={key:1,class:"pt-42px text-center text-gray-400"},Me=M({__name:"EActionModal",emits:["add","edit"],setup($,{expose:k,emit:r}){const x=r,C=O.getComponent("modal"),y=E(!0),_=R("pageSchema"),m=R("pageManager",{}),u=E(!1),a=E([]),v=E(null),e=Z({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}}),l=S(()=>{var o;return e.actionItem.type==="component"?v.value?(o=O.getComponentConfings()[v.value.type].config.action)==null?void 0:o.map(t=>({label:t.describe,value:t.type})):[]:e.actionItem.type==="custom"?Object.entries(m.funcs.value).filter(([t,V])=>typeof V=="function").map(([t])=>({label:t,value:t})):e.actionItem.type==="public"?Object.entries(O.publicMethods).map(([t])=>({label:t,value:t})):[]}),n=S(()=>{if(e.actionItem.type==="component"&&v.value){const o=O.getComponentConfings()[v.value.type].config.action,t=o==null?void 0:o.find(V=>V.type===e.actionItem.methodName);if(t!=null&&t.argsConfigs){const V=t.argsConfigs.findIndex(I=>I.label==="设置数据");V!==-1&&(t.argsConfigs[V]={...v.value,label:"设置数据",field:"0",id:G()})}return(t==null?void 0:t.argsConfigs)??[]}return[]});function f(){var o;u.value=!0,y.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(o=l.value)!=null&&o.length&&d(l.value[0].value)}function N(o){if(u.value=!0,y.value=!1,v.value=null,o.componentId){const t=F(_.schemas,o.componentId);v.value=t,a.value=[o.componentId]}ee(()=>{e.actionItem.componentId=o.componentId,e.actionItem.methodName=o.methodName,e.actionItem.type=o.type,e.actionItem.args=o.args})}function w(){if(!e.actionItem.methodName){alert("请先选择动作方法");return}x(y.value?"add":"edit",H(X(e.actionItem))),j()}function j(){u.value=!1,a.value=[],e.cacheData={}}function i(o){var t;e.actionItem.componentId=null,e.actionItem.type=o,v.value=null,e.actionItem.methodName=null,a.value=[],(t=l.value)!=null&&t.length&&d(l.value[0].value)}function s(o){var t;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=o.id,e.actionItem.type="component",e.actionItem.methodName=null,v.value=o.componentSchema,(t=l.value)!=null&&t.length&&d(l.value[0].value)}function d(o){e.actionItem.methodName=o,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return k({handleOpen:f,handleOpenEdit:N}),(o,t)=>(p(),L(h(C),{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=V=>u.value=V),class:"w-1200px",width:"1200px",title:"动作配置",onClose:j,onOk:w},{default:B(()=>{var V;return[c("div",Ve,[c("div",be,[c("div",ke,[c("div",{class:K(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:t[0]||(t[0]=I=>i("custom"))}," 自定义函数 ",2),c("div",{class:K(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:t[1]||(t[1]=I=>i("public"))}," 公共函数 ",2),T(" 组件 "),c("div",Ee,[b(h(te),{selectedKeys:a.value,"onUpdate:selectedKeys":t[2]||(t[2]=I=>a.value=I),options:h(_).schemas,onNodeClick:s},null,8,["selectedKeys","options"])])]),c("div",$e,[Ne,c("div",we,[(p(!0),g(U,null,z(l.value,I=>(p(),g("div",{key:I.value,class:K([{checked:I.value===e.actionItem.methodName},"elegant-action-item"]),onClick:je=>d(I.value)},[c("span",null,A(I.label),1)],10,Oe))),128)),P(c("div",Se," 当前组件暂无动作 ",512),[[W,!((V=l.value)!=null&&V.length)]])])])]),c("div",Ae,[e.actionItem.type==="custom"?(p(),L(_e,{key:0})):n.value.length===0?(p(),g("div",Ue," 暂无配置 ")):(p(),L(Ce,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":t[3]||(t[3]=I=>e.actionItem.args=I),"action-args-configs":n.value},null,8,["modelValue","action-args-configs"]))])])]}),_:1},8,["modelValue"]))}}),bt=M({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup($,{emit:k}){const r=$,x=k,C=O.getComponent("Collapse"),y=O.getComponent("CollapseItem"),_=E(null);let m=0;const u=S({get(){return r.modelValue},set(i){x("update:modelValue",i)}}),a=E([]),v=S(()=>r.eventList.filter(i=>i.events.length)),e=S(()=>r.eventList.map(i=>i.events).flat()),l=E({});e.value.forEach(i=>{l.value[i.type]=S({get(){var s;return((s=u.value)==null?void 0:s[i.type])??[]},set(s){s&&s.length?u.value[i.type]=s.map(d=>X(d)):delete u.value[i.type]}})}),J(()=>v.value,i=>{i.length&&(a.value=i.filter(s=>{for(let d=0;d<s.events.length;d++){const o=s.events[d].type;if(l.value[o].length)return!0}return!1}).map(s=>s.title))},{immediate:!0});let n="";function f(i){var s;(s=_.value)==null||s.handleOpen(),n=i}function N(i,s,d){var o;(o=_.value)==null||o.handleOpenEdit(d),m=i,n=s}function w(i){l.value[n][m]=i,u.value[n]=[...l.value[n]??[]]}function j(i){if(!u.value){u.value={[n]:[...l.value[n]??[],i]};return}u.value[n]=[...l.value[n]??[],i]}return(i,s)=>(p(),g(U,null,[b(h(C),{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value=d),activeKey:a.value,"onUpdate:activeKey":s[2]||(s[2]=d=>a.value=d),"expanded-names":a.value,"onUpdate:expandedNames":s[3]||(s[3]=d=>a.value=d)},{default:B(()=>[(p(!0),g(U,null,z(v.value,d=>(p(),L(h(y),{key:d.title,title:d.title,header:d.title,name:d.title},{default:B(()=>[b(fe,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),"item-events":d.events,"all-events":e.value,events:l.value,onAdd:f,onEdit:N},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey","expanded-names"]),b(Me,{ref_key:"EActionModalRef",ref:_,onAdd:j,onEdit:w},null,512)],64))}});export{bt as default};
