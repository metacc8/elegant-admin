
/**
 * 由 MrZhang 提供技术支持
 * Powered by elegant-admin
 * Github https://github.com/zhangyao1990/elegant-admin
 */

import{p as O}from"./index-CF0Df7v0.js";import{d as q}from"./vuedraggable-Ce-5l_FJ.js";import{h as F,_ as G,e as H,i as Q}from"./index-BinNfzbw.js";import{_ as D}from"./icon.vue_vue_type_script_setup_true_lang-CXPPfzEY.js";import{d as M,i as R,k as J,w as T,a as v,c as y,aa as z,f as c,a0 as A,a1 as b,u as g,X as B,_ as Z,$ as P,F as U,r as $,b as S,Y as W,a2 as X,m as K,W as L,n as ee,ag as Y}from"./@vue-DJ53MWs5.js";import{_ as te}from"./tree.vue_vue_type_script_setup_true_lang-C3ExpVAY.js";import"./vite-plugin-fake-server-4rIte7rE.js";import"./mockjs-Dd0W0IWH.js";import"./@imengyu-BQwzwvVc.js";import"./vue-CAygiDOH.js";import"./floating-vue-DjZaMi6K.js";import"./@floating-ui-Y0iFLo_g.js";import"./vue-m-message-BxJX2Zqc.js";import"./overlayscrollbars-CZjZ1Dbc.js";import"./@iconify-C4HLlXtv.js";import"./overlayscrollbars-vue-BxfA_dC8.js";import"./@headlessui-Bm2TyfRI.js";import"./mitt-DJ65BbbF.js";import"./crypto-js-RCkyKLW7.js";import"./lodash-es-l8Yk8yFo.js";import"./pinia-DmVFObHF.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-Bg2mojPD.js";import"./hotkeys-js-BfWqkGRU.js";import"./element-plus-C6knWGiR.js";import"./@vueuse-DVujDNXP.js";import"./nprogress-BdJdCxhg.js";import"./@element-plus-Ngrzdf6G.js";import"./@sxzz-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-p2P62yYc.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./vue-i18n-BnGu2oZ8.js";import"./@intlify-CEEhciFb.js";import"./colord-CrBFWQzZ.js";import"./monaco-editor-PTJBK6lV.js";import"./path-browserify-DTVwunqE.js";import"./axios-DmypytPv.js";import"./sortablejs-C_eVYoc1.js";import"./vue-esign-BNnrYaMl.js";const ne={class:"elegant-event-info"},oe=["title"],ae={class:"elegant-event-btn"},le={class:"elegant-action-editor-main"},se={class:"elegant-editor-item"},ie={class:"w-36px text-lg"},ce={class:"flex-1"},de={key:0},ue={key:1},re={key:2},me={class:"elegant-action-box"},pe=["onClick"],ve=["onClick"],fe=M({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>{}},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup(E,{emit:k}){const r=E,C=k,V=R("pageSchema"),x=J({...r.events});T(()=>r.events,e=>{Object.assign(x,e)},{deep:!0,immediate:!0});function I(e){C("add",e)}function p(e){return F(V.schemas,e).label}function u(e,l){var h;const t=f(l);t[l]=r.events[l].filter((N,w)=>e!==w),(h=t[l])!=null&&h.length||delete t[l],C("update:modelValue",t)}function a(e,l,t){C("edit",e,l,t)}function f(e){const l={};return r.allEvents.forEach(t=>{if(!r.events[t.type].length||t.type===e)return!1;l[t.type]=r.events[t.type]}),l}return(e,l)=>(v(!0),y(U,null,z(E.itemEvents,t=>(v(),y("div",{key:t.type,class:"elegant-event-item"},[c("div",ne,[c("div",{class:"elegant-event-label",title:t.describe},A(t.describe),9,oe),c("div",ae,[b(g(D),{name:"icon-tianjia",onClick:h=>I(t.type)},null,8,["onClick"])])]),c("div",le,[b(g(q),{modelValue:g(x)[t.type],"onUpdate:modelValue":h=>g(x)[t.type]=h,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:B(({element:h,index:N})=>[c("div",se,[c("div",ie,[b(g(D),{class:"handle mr-2 cursor-move text-lg",name:"icon-tuozhuai"})]),c("div",ce,[h.type==="component"?(v(),y("div",de,A(p(h.componentId)),1)):h.type==="custom"?(v(),y("div",ue," 自定义函数 ")):h.type==="public"?(v(),y("div",re," 公共函数 ")):Z("",!0),P(" "+A(h.methodName),1)]),c("div",me,[c("div",{class:"elegant-edit-btn",onClick:w=>a(N,t.type,h)},[b(g(D),{name:"icon-tiaozheng"})],8,pe),c("div",{class:"elegant-del-btn",onClick:w=>u(N,t.type)},[b(g(D),{name:"icon-shanchu1"})],8,ve)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),he={class:"h-full flex flex-col"},ge=c("div",{class:"pb-2"}," 自定义函数编辑 ",-1),_e=M({__name:"EScriptEdit",setup(E){const k=O.getComponent("monacoEditor"),r={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},C=$(null),V=R("pageSchema");return(x,I)=>(v(),y("div",he,[ge,b(g(k),{ref_key:"monacoEditorRef",ref:C,modelValue:g(V).script,"onUpdate:modelValue":I[0]||(I[0]=p=>g(V).script=p),"auto-toggle-theme":"",class:"elegant-editor flex-1",config:r,language:"javascript"},null,8,["modelValue"])]))}}),ye={class:"elegant-attribute-view"},Ie=["title"],xe={class:"elegant-attr-input"},Ce=M({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup(E,{emit:k}){const r=E,C=k,V=S(()=>r.modelValue?JSON.parse(r.modelValue):[]);function x(p){var u;return typeof p.show=="boolean"?p.show:typeof p.show=="function"?(u=p.show)==null?void 0:u.call(p,{values:V.value}):!0}function I(p,u){const a=[...JSON.parse(r.modelValue??"[]")];a[u]=p,C("update:modelValue",JSON.stringify(a))}return(p,u)=>(v(),y("div",ye,[(v(!0),y(U,null,z(r.actionArgsConfigs,a=>(v(),y("div",{key:a.field+a.type},[W(c("div",{class:K(["elegant-attr-item",a.layout])},[c("div",{class:"elegant-attr-label",title:a.label},A(a.label),9,Ie),c("div",xe,[b(g(G),{"component-schema":{...a,componentProps:{...a.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":V.value[a.field],"onUpdate:modelValue":f=>I(f,a.field)},null,8,["component-schema","model-value","onUpdate:modelValue"])])],2),[[X,x(a)]])]))),128))]))}}),Ve={class:"elegant-modal-action-main rounded"},be={class:"elegant-modal-left-panel h-full flex flex-col"},ke={class:"h-0 flex flex-1 flex-col"},Ee={class:"h-0 flex-1"},$e={class:"elegant-action-select h-30/100 flex flex-col"},Ne=c("div",{class:"mb-2"}," 动作选择 ",-1),we={class:"flex-1 overflow-auto pr-8px"},Oe=["onClick"],Se={class:"pt-42px text-center text-gray-400"},Ae={class:"elegant-modal-right-panel"},Ue={key:1,class:"pt-42px text-center text-gray-400"},Me=M({__name:"EActionModal",emits:["add","edit"],setup(E,{expose:k,emit:r}){const C=r,V=O.getComponent("modal"),x=$(!0),I=R("pageSchema"),p=R("pageManager",{}),u=$(!1),a=$([]),f=$(null),e=J({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}}),l=S(()=>{var n,o;return e.actionItem.type==="component"?(n=f.value)!=null&&n.type?(o=O.getComponentConfings()[f.value.type].config.action)==null?void 0:o.map(m=>({label:m.describe,value:m.type})):[]:e.actionItem.type==="custom"?Object.entries(p.funcs.value).filter(([m,_])=>typeof _=="function").map(([m])=>({label:m,value:m})):e.actionItem.type==="public"?Object.entries(O.publicMethods).map(([m])=>({label:m,value:m})):[]}),t=S(()=>{if(e.actionItem.type==="component"&&f.value){const n=O.getComponentConfings()[f.value.type].config.action,o=n==null?void 0:n.find(m=>m.type===e.actionItem.methodName);if(o!=null&&o.argsConfigs){const m=o.argsConfigs.findIndex(_=>_.label==="设置数据");m!==-1&&(o.argsConfigs[m]={...f.value,label:"设置数据",field:"0",id:H()})}return(o==null?void 0:o.argsConfigs)??[]}return[]});function h(){var n;u.value=!0,x.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(n=l.value)!=null&&n.length&&d(l.value[0].value)}function N(n){if(u.value=!0,x.value=!1,f.value=null,n.componentId){const o=F(I.schemas,n.componentId);f.value=o,a.value=[n.componentId]}ee(()=>{e.actionItem.componentId=n.componentId,e.actionItem.methodName=n.methodName,e.actionItem.type=n.type,e.actionItem.args=n.args})}function w(){if(!e.actionItem.methodName){alert("请先选择动作方法");return}C(x.value?"add":"edit",Q(Y(e.actionItem))),j()}function j(){u.value=!1,a.value=[],e.cacheData={}}function i(n){var o;e.actionItem.componentId=null,e.actionItem.type=n,f.value=null,e.actionItem.methodName=null,a.value=[],(o=l.value)!=null&&o.length&&d(l.value[0].value)}function s(n){var o;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=n.id,e.actionItem.type="component",e.actionItem.methodName=null,f.value=n.componentSchema,(o=l.value)!=null&&o.length&&d(l.value[0].value)}function d(n){e.actionItem.methodName=n,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return k({handleOpen:h,handleOpenEdit:N}),(n,o)=>(v(),L(g(V),{modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=m=>u.value=m),class:"w-1200px",width:"1200px",title:"动作配置",onClose:j,onOk:w},{default:B(()=>{var m;return[c("div",Ve,[c("div",be,[c("div",ke,[c("div",{class:K(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:o[0]||(o[0]=_=>i("custom"))}," 自定义函数 ",2),c("div",{class:K(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:o[1]||(o[1]=_=>i("public"))}," 公共函数 ",2),P(" 组件 "),c("div",Ee,[b(g(te),{selectedKeys:a.value,"onUpdate:selectedKeys":o[2]||(o[2]=_=>a.value=_),options:g(I).schemas,onNodeClick:s},null,8,["selectedKeys","options"])])]),c("div",$e,[Ne,c("div",we,[(v(!0),y(U,null,z(l.value,_=>(v(),y("div",{key:_.value,class:K([{checked:_.value===e.actionItem.methodName},"elegant-action-item"]),onClick:je=>d(_.value)},[c("span",null,A(_.label),1)],10,Oe))),128)),W(c("div",Se," 当前组件暂无动作 ",512),[[X,!((m=l.value)!=null&&m.length)]])])])]),c("div",Ae,[e.actionItem.type==="custom"?(v(),L(_e,{key:0})):t.value.length===0?(v(),y("div",Ue," 暂无配置 ")):(v(),L(Ce,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":o[3]||(o[3]=_=>e.actionItem.args=_),"action-args-configs":t.value},null,8,["modelValue","action-args-configs"]))])])]}),_:1},8,["modelValue"]))}}),bt=M({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup(E,{emit:k}){const r=E,C=k,V=O.getComponent("Collapse"),x=O.getComponent("CollapseItem"),I=$(null);let p=0;const u=S({get(){return r.modelValue},set(i){C("update:modelValue",i)}}),a=$([]),f=S(()=>r.eventList.filter(i=>i.events.length)),e=S(()=>r.eventList.map(i=>i.events).flat()),l=$({});e.value.forEach(i=>{l.value[i.type]=S({get(){var s;return((s=u.value)==null?void 0:s[i.type])??[]},set(s){s&&s.length?u.value[i.type]=s.map(d=>Y(d)):delete u.value[i.type]}})}),T(()=>f.value,i=>{i.length&&(a.value=i.filter(s=>{for(let d=0;d<s.events.length;d++){const n=s.events[d].type;if(l.value[n].length)return!0}return!1}).map(s=>s.title))},{immediate:!0});let t="";function h(i){var s;(s=I.value)==null||s.handleOpen(),t=i}function N(i,s,d){var n;(n=I.value)==null||n.handleOpenEdit(d),p=i,t=s}function w(i){l.value[t][p]=i,u.value[t]=[...l.value[t]??[]]}function j(i){if(!u.value){u.value={[t]:[...l.value[t]??[],i]};return}u.value[t]=[...l.value[t]??[],i]}return(i,s)=>(v(),y(U,null,[b(g(V),{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value=d),activeKey:a.value,"onUpdate:activeKey":s[2]||(s[2]=d=>a.value=d),"expanded-names":a.value,"onUpdate:expandedNames":s[3]||(s[3]=d=>a.value=d)},{default:B(()=>[(v(!0),y(U,null,z(f.value,d=>(v(),L(g(x),{key:d.title,title:d.title,header:d.title,name:d.title},{default:B(()=>[b(fe,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=n=>u.value=n),"item-events":d.events,"all-events":e.value,events:l.value,onAdd:h,onEdit:N},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey","expanded-names"]),b(Me,{ref_key:"EActionModalRef",ref:I,onAdd:j,onEdit:w},null,512)],64))}});export{bt as default};
